---
layout: post
title: HTTP 和 HTTPS
author: sleticalboy
date: 2021-04-09 09:00:07 +0800
category: net
tags: [net]
---

## HTTP

### 是什么

超文本传输协议

### 三次握手

建立一个 TCP 连接时，客户端和服务端一共需要发送 3 个包。三次握手的主要作用是确认双方
的发送能力和接收能力是否正常、指定自己的初始化序列号为后面的可靠性传输做准备。实质上
就是连接服务器指定的端口号，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 
窗口大小信息。

1、三次握手过程

一开始的时候，client 处于 closed 状态；server 处于 listen 状态。

进行三次握手：

- 第一次：客户端给服务端发一个 SYN 报文，同时指明客户端的 ISN，此时客户端处于 `SYN_SENT` 状态。
- 第二次：服务端收到客户端的 SYN 报文之后，会以自己的 SYN 报文作为应答，并指定自己的 ISN。
同时把客户端的 ISN + 1 作为 ACK 值，表示自己已收到客户端的 SYN，此时服务端处于 `SYN_RCVD` 状态。
- 第三次：客户端收到 SYN 报文之后，会发送一个 ACK 报文(服务端 SYN + 1)，表示已经收到
服务端的 SYN 报文，此时客户端处于 `ESTABLISHED` 状态。当服务端收到 ACK 报文后也处于
`ESTABLISHED` 状态，此时双方已建立连接。

socket 编程中，客户端执行 socket() 时，将触发三次握手。

![三次握示意图]()

2、为什么需要三次握手，两次可以么？

2.1、三次握手的目的：

- 第一次：服务端收到客户端的报文后确认客户端的发送能力正常；
- 第二次：客户端收到服务端的报文后确认服务端的接收能力、发送能力正常；
- 第三次：服务端收到客户端的报文后确认客户端的接收能力正常；

2.2、两次握手有什么问题？

```
客户端发起两次连接，但是第一次因为网络阻塞没有收到，只收到了第二次；第二次建立连接并完
成通讯后，双方都关闭了连接；此时第一次请求到底服务端了，服务端随即建立连接，客户端忽略
服务端发来的确认，也不发送数据，服务端一直等待客户端发送数据，造成服务端资源浪费。
```

### 四次挥手

- client -> server：我要断开了
- server -> client：你断开吧
- server -> client：我断开了
- client -> server：我断开了

### 特点

- 无状态：协议对客户端没有状态存储，对事务处理没有记忆能力，比如网站需要反复登录
- 无连接：HTTP/1.1 之前，由于无状态，每次请求都需要 TCP 三次握手
  - cookie/session
  - Connection: keep-alive，只要任意一端没有明确提出断开连接，则保持 TCP 连接
- 基于请求和响应：client 请求、server 响应
- 简单快速、灵活
- 明文请求、响应；不安全；无法保证数据的完整性

## HTTPS

### 是什么

超文本安全传输协议，基于 HTTP，通过 SSL/TLS 提供加密数据处理、验证对方身份以及数据完整保护

### 实现原理

- 协议、默认端口号
- 明文传输、加密传输、安全
- 效率

### 特点

- 内容加密
- 验证身份
- 保护数据完整性