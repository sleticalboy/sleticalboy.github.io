<svg xmlns="http://www.w3.org/2000/svg" height="1597" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1132 1597" width="1132" xmlns:ev="http://www.w3.org/2001/xml-events"><style type="text/css"><![CDATA[
.st1 {fill:#191919;font-family:微软雅黑;font-size:10pt}
.st2 {font-family:Arial;font-size:10pt}
]]></style><defs/><g id="page1" transform="translate(5,5)"><rect fill="#ffffff" height="1587" stroke="#808080" x="0" width="1123" y="0"/><g id="shape1" transform="translate(163,57)"><path fill-rule="evenodd" fill="#cfebf6" d="M22,44L143,44C155.2,44,165,34.2,165,22C165,9.8,155.2,0,143,0L22,0C9.8,0,0,9.8,0,22C0,34.2,9.8,44,22,44z" stroke="#323232"/><text class="st1"><tspan x="32" y="26">Engine#load(cb)</tspan></text></g><g id="shape2" transform="translate(245.5,101)"><path fill="none" stroke="#323232" d="M0,0L0,28.5"/><path fill="#323232" stroke="#323232" d="M0,32.9L3,27.7C2.1,28.2,1.1,28.5,0,28.5C-1.1,28.5,-2.1,28.2,-3,27.7L0,32.9" stroke-linecap="round" stroke-width="1"/></g><g id="shape3" transform="translate(163,133.85)"><path fill-rule="evenodd" fill="#ffffff" d="M165,55.1L165,0L0,0L0,55.1L165,55.1z" stroke="#323232"/><text class="st1"><tspan x="55" y="23">生成 key </tspan><tspan x="17" y="41">keyFactory.buildKey()</tspan></text></g><g id="shape4" transform="translate(245.5,189)"><path fill="none" stroke="#323232" d="M0,0L0,34.5"/><path fill="#323232" stroke="#323232" d="M0,38.9L3,33.7C2.1,34.2,1.1,34.5,0,34.5C-1.1,34.5,-2.1,34.2,-3,33.7L0,38.9" stroke-linecap="round" stroke-width="1"/></g><g id="shape5" transform="translate(163,227.85)"><path fill-rule="evenodd" fill="#ffffff" d="M165,55.1L165,0L0,0L0,55.1L165,55.1z" stroke="#323232"/><text class="st1"><tspan x="42" y="23">从内存中获取 </tspan><tspan x="22" y="41">getFromCache(key)</tspan></text></g><g id="shape6" transform="translate(245.5,283)"><path fill="none" stroke="#323232" d="M0,0L0,34.5"/><path fill="#323232" stroke="#323232" d="M0,38.9L3,33.7C2.1,34.2,1.1,34.5,0,34.5C-1.1,34.5,-2.1,34.2,-3,33.7L0,38.9" stroke-linecap="round" stroke-width="1"/></g><g id="shape7" transform="translate(126.25,321.85)"><path fill-rule="evenodd" fill="#ffffff" d="M119.3,56L238.5,28L119.3,0L0,28L119.3,56z" stroke="#323232"/><text class="st1"><tspan x="38.3" y="23">EngineSource&lt;?> cached </tspan><tspan x="93.3" y="41">是否存在</tspan></text></g><g id="shape8" transform="translate(632.75,321.85)"><path fill-rule="evenodd" fill="#ffffff" d="M191.3,56L191.3,0L0,0L0,56L191.3,56z" stroke="#323232"/><text class="st1"><tspan x="44.1" y="23">回调给上层调用者</tspan><tspan x="9.1" y="41">cb.onResourceReady(cache)</tspan></text></g><g id="shape9" transform="translate(245.5,377.85)"><path fill="none" stroke="#323232" d="M0,0L0,61.8"/><path fill="#323232" stroke="#323232" d="M0,66.1L3,61C2.1,61.5,1.1,61.8,0,61.8C-1.1,61.8,-2.1,61.5,-3,61L0,66.1" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="-4.6" width="9.2" y="20.5"/><text class="st2"><tspan x="-4.7" y="31.5">N</tspan></text></g><g id="shape10" transform="translate(163,444)"><path fill-rule="evenodd" fill="#ffffff" d="M165,56L165,0L0,0L0,56L165,56z" stroke="#323232"/><text class="st1"><tspan x="18" y="32">尝试从活动资源中加载</tspan></text></g><g id="shape11" transform="translate(364.75,349.85)"><path fill="none" stroke="#323232" d="M0,0L62.4,0"/><path fill="#323232" stroke="#323232" d="M66.8,0L61.6,-3C62.1,-2.1,62.4,-1.1,62.4,0C62.4,1.1,62.1,2.1,61.6,3L66.8,0" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="22.1" width="8.2" y="-7.5"/><text class="st2"><tspan x="22" y="3.5">Y</tspan></text></g><g id="shape12" transform="translate(431.5,321.85)"><path fill-rule="evenodd" fill="#ffffff" d="M151,56L151,0L0,0L0,56L151,56z" stroke="#323232"/><text class="st1"><tspan x="41" y="23">引用计数+1</tspan><tspan x="24" y="41">并放入活动资源中</tspan></text></g><g id="shape13" transform="translate(582.5,349.85)"><path fill="none" stroke="#323232" d="M0,0L45.9,0"/><path fill="#323232" stroke="#323232" d="M50.3,0L45.1,-3C45.6,-2.1,45.9,-1.1,45.9,0C45.9,1.1,45.6,2.1,45.1,3L50.3,0" stroke-linecap="round" stroke-width="1"/></g><g id="shape14" transform="translate(245.5,500)"><path fill="none" stroke="#323232" d="M0,0L0,47.2"/><path fill="#323232" stroke="#323232" d="M0,51.6L3,46.4C2.1,46.9,1.1,47.2,0,47.2C-1.1,47.2,-2.1,46.9,-3,46.4L0,51.6" stroke-linecap="round" stroke-width="1"/></g><g id="shape15" transform="translate(126.25,551.55)"><path fill-rule="evenodd" fill="#ffffff" d="M119.3,72.4L238.5,36.2L119.3,0L0,36.2L119.3,72.4z" stroke="#323232"/><text class="st1"><tspan x="9.3" y="31.2">WeakReference&lt;EngineResource&lt;?</tspan><tspan x="51.3" y="49.2">>> activeRef 是否存在</tspan></text></g><g id="shape16" transform="translate(364.75,587.78)"><path fill="none" stroke="#323232" d="M0,0L38.9,0"/><path fill="#323232" stroke="#323232" d="M43.3,0L38.1,-3C38.6,-2.1,38.9,-1.1,38.9,0C38.9,1.1,38.6,2.1,38.1,3L43.3,0" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="12" width="8.2" y="-7.5"/><text class="st2"><tspan x="11.9" y="3.5">Y</tspan></text></g><g id="shape17" transform="translate(408,543.78)"><path fill-rule="evenodd" fill="#ffffff" d="M99,88L198,44L99,0L0,44L99,88z" stroke="#323232"/><text class="st1"><tspan x="29" y="39">active = activeRef.get()</tspan><tspan x="71" y="57"> 是否存在</tspan></text></g><g id="shape18" transform="translate(507,543.78)"><path fill="none" stroke="#323232" d="M0,0L0,-161.5"/><path fill="#323232" stroke="#323232" d="M0,-165.9L-3,-160.7C-2.1,-161.2,-1.1,-161.5,0,-161.5C1.1,-161.5,2.1,-161.2,3,-160.7L0,-165.9" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="-4.2" width="8.2" y="-71.6"/><text class="st2"><tspan x="-4.3" y="-60.6">Y</tspan></text></g><g id="shape19" transform="translate(606,587.78)"><path fill="none" stroke="#323232" d="M0,0L90.6,-0"/><path fill="#323232" stroke="#323232" d="M95,-0L89.8,-3C90.3,-2.1,90.6,-1.1,90.6,-0C90.6,1.1,90.3,2.1,89.8,3L95,-0" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="32.8" width="9.2" y="-7.5"/><text class="st2"><tspan x="32.6" y="3.5">N</tspan></text></g><g id="shape20" transform="translate(701,559.78)"><path fill-rule="evenodd" fill="#ffffff" d="M94,56L94,0L0,0L0,56L94,56z" stroke="#323232"/><text class="st1"><tspan x="8" y="23">从活动资源中</tspan><tspan x="34" y="41">移除</tspan></text></g><g id="shape21" transform="translate(245.5,624)"><path fill="none" stroke="#323232" d="M0,0L0,55.6"/><path fill="#323232" stroke="#323232" d="M0,60L3,54.8C2.1,55.3,1.1,55.6,0,55.6C-1.1,55.6,-2.1,55.3,-3,54.8L0,60" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="-4.6" width="9.2" y="17.2"/><text class="st2"><tspan x="-4.7" y="28.2">N</tspan></text></g><g id="shape22" transform="translate(126.25,684)"><path fill-rule="evenodd" fill="#ffffff" d="M119.3,56L238.5,28L119.3,0L0,28L119.3,56z" stroke="#323232"/><text class="st1"><tspan x="15.3" y="23">EngineJob current = jobs.get(key)</tspan><tspan x="67.3" y="41">加载任务是否存在</tspan></text></g><g id="shape23" transform="translate(245.5,740)"><path fill="none" stroke="#323232" d="M0,0L0,55.6"/><path fill="#323232" stroke="#323232" d="M0,60L3,54.8C2.1,55.3,1.1,55.6,0,55.6C-1.1,55.6,-2.1,55.3,-3,54.8L0,60" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="-4.6" width="9.2" y="22.2"/><text class="st2"><tspan x="-4.7" y="33.2">N</tspan></text></g><g id="shape24" transform="translate(163,800)"><path fill-rule="evenodd" fill="#ffffff" d="M165,56L165,0L0,0L0,56L165,56z" stroke="#323232"/><text class="st1"><tspan x="18" y="32">创建新任务并开始执行</tspan></text></g><g id="shape25" transform="translate(364.75,712)"><path fill="none" stroke="#323232" d="M0,0L55.6,0"/><path fill="#323232" stroke="#323232" d="M60,0L54.8,-3C55.3,-2.1,55.6,-1.1,55.6,0C55.6,1.1,55.3,2.1,54.8,3L60,0" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="22.3" width="8.2" y="-7.5"/><text class="st2"><tspan x="22.2" y="3.5">Y</tspan></text></g><g id="shape26" transform="translate(424.75,677)"><path fill-rule="evenodd" fill="#ffffff" d="M172.3,70L172.3,0L0,0L0,70L172.3,70z" stroke="#323232"/><text class="st1"><tspan x="60.1" y="30">添加回调</tspan><tspan x="13.1" y="48">current.addCallback(cb)</tspan></text></g><g id="shape27" transform="translate(245.5,856)"><path fill="none" stroke="#323232" d="M0,0L0,55.6"/><path fill="#323232" stroke="#323232" d="M0,60L3,54.8C2.1,55.3,1.1,55.6,0,55.6C-1.1,55.6,-2.1,55.3,-3,54.8L0,60" stroke-linecap="round" stroke-width="1"/></g><g id="shape28" transform="translate(163,916)"><path fill-rule="evenodd" fill="#ffffff" d="M165,56L165,0L0,0L0,56L165,56z" stroke="#323232"/><text class="st1"><tspan x="5" y="32">先从磁盘加载再从源头加载</tspan></text></g><g id="shape29" transform="translate(328,944)"><path fill="none" stroke="#323232" d="M0,0L55.6,0"/><path fill="#323232" stroke="#323232" d="M60,0L54.8,-3C55.3,-2.1,55.6,-1.1,55.6,0C55.6,1.1,55.3,2.1,54.8,3L60,0" stroke-linecap="round" stroke-width="1"/></g><g id="shape30" transform="translate(388,916)"><path fill-rule="evenodd" fill="#ffffff" d="M82.5,56L165,28L82.5,0L0,28L82.5,56z" stroke="#323232"/><text class="st1"><tspan x="44" y="32">加载是否完成</tspan></text></g><g id="shape31" transform="translate(553,944)"><path fill="none" stroke="#323232" d="M0,0L55.6,0"/><path fill="#323232" stroke="#323232" d="M60,0L54.8,-3C55.3,-2.1,55.6,-1.1,55.6,0C55.6,1.1,55.3,2.1,54.8,3L60,0" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="22" width="8.2" y="-7.5"/><text class="st2"><tspan x="21.9" y="3.5">Y</tspan></text></g><g id="shape32" transform="translate(613,916)"><path fill-rule="evenodd" fill="#ffffff" d="M94,56L94,0L0,0L0,56L94,56z" stroke="#323232"/><text class="st1"><tspan x="7" y="23">通过 Handler </tspan><tspan x="6" y="41">回调成功到 UI</tspan></text></g><g id="shape33" transform="translate(613,800)"><path fill-rule="evenodd" fill="#ffffff" d="M94,56L94,0L0,0L0,56L94,56z" stroke="#323232"/><text class="st1"><tspan x="7" y="23">通过 Handler </tspan><tspan x="6" y="41">回调失败到 UI</tspan></text></g><g id="shape34" transform="translate(470.5,916)"><path fill="none" stroke="#323232" d="M0,0L0,-88L138.1,-88"/><path fill="#323232" stroke="#323232" d="M142.5,-88L137.3,-91C137.8,-90.1,138.1,-89.1,138.1,-88C138.1,-86.9,137.8,-85.9,137.3,-85L142.5,-88" stroke-linecap="round" stroke-width="1"/><rect fill="#ffffff" height="15" x="-4.6" width="9.2" y="-55.8"/><text class="st2"><tspan x="-4.7" y="-44.8">N</tspan></text></g><g id="shape35" transform="translate(907,690)"><path fill-rule="evenodd" fill="#cfebf6" d="M22,44L72,44C84.2,44,94,34.2,94,22C94,9.8,84.2,0,72,0L22,0C9.8,0,0,9.8,0,22C0,34.2,9.8,44,22,44z" stroke="#323232"/><text class="st1"><tspan x="34" y="26">结束</tspan></text></g><g id="shape36" transform="translate(824,349.85)"><path fill="none" stroke="#323232" d="M0,0L130,0L130,335.8"/><path fill="#323232" stroke="#323232" d="M130,340.1L133,335C132.1,335.5,131.1,335.8,130,335.8C128.9,335.8,127.9,335.5,127,335L130,340.1" stroke-linecap="round" stroke-width="1"/></g><g id="shape37" transform="translate(707,944)"><path fill="none" stroke="#323232" d="M0,0L247,0L247,-205.6"/><path fill="#323232" stroke="#323232" d="M247,-210L244,-204.8C244.9,-205.3,245.9,-205.6,247,-205.6C248.1,-205.6,249.1,-205.3,250,-204.8L247,-210" stroke-linecap="round" stroke-width="1"/></g><g id="shape38" transform="translate(597,712)"><path fill="none" stroke="#323232" d="M0,0L305.6,0"/><path fill="#323232" stroke="#323232" d="M310,0L304.8,-3C305.3,-2.1,305.6,-1.1,305.6,0C305.6,1.1,305.3,2.1,304.8,3L310,0" stroke-linecap="round" stroke-width="1"/></g><g id="shape39" transform="translate(795,587.78)"><path fill="none" stroke="#323232" d="M0,0L154.6,0"/><path fill="#323232" stroke="#323232" d="M159,0L153.8,-3C154.3,-2.1,154.6,-1.1,154.6,0C154.6,1.1,154.3,2.1,153.8,3L159,0" stroke-linecap="round" stroke-width="1"/></g><g id="shape40" transform="translate(707,828)"><path fill="none" stroke="#323232" d="M0,0L242.6,0"/><path fill="#323232" stroke="#323232" d="M247,0L241.8,-3C242.3,-2.1,242.6,-1.1,242.6,0C242.6,1.1,242.3,2.1,241.8,3L247,0" stroke-linecap="round" stroke-width="1"/></g></g></svg>